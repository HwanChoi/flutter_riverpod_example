# FIXPLAN: 코드 개선 계획

이 문서는 코드 리뷰를 통해 발견된 개선 사항들을 추적하고 관리하기 위한 계획서입니다.

---

### 심각도: 높은 항목 (우선 해결 권장)

- [ ] **불변성 노출**: 상태 클래스(`AssemblyLineState`, `Car` 등) 내의 가변 `List`를 `List.unmodifiable` 또는 `defensive copy`를 사용하여 불변 객체로 변경합니다.
- [ ] **에러 상태 미노출**: `CarAssemblyNotifier` 등에서 발생하는 에러를 `print`로만 처리하지 않고, 상태 클래스에 에러 필드를 추가하여 UI에 명확히 전달합니다.
- [ ] **중복/혼동되는 파일/이름 정리**: `auth_repository.dart`와 `auth_notifier.dart` 등 중복되거나 혼동을 일으키는 파일을 제거하고, 인증 관련 책임을 단일화합니다.

### 우선순위: 중간 항목

- [ ] **Stream/Subscription 관리**: 모든 `StateNotifier` 및 `AsyncNotifier`의 `dispose` 메소드에서 `StreamSubscription`, `Timer` 등 비동기 리소스가 안전하게 정리되는지 전수 검사합니다.
- [ ] **코드 생성 파일 관리**: CI/CD 파이프라인에 `flutter pub run build_runner build --delete-conflicting-outputs`와 같은 코드 생성 명령어가 포함되어 있는지 확인하고, 누락 시 추가합니다.
- [ ] **UI 차단 가능성 검토**: 잠재적으로 긴 동기 연산이 있는지 확인하고, 발견 시 `Isolate`나 비동기 처리로 전환하여 UI 멈춤 현상을 방지합니다.

### 권장 개선 (실행 시 행동·사용자 경험 개선)

- [ ] **상태 불변화 적용**: (높은 항목과 동일) 상태 및 모델 객체의 불변성을 보장합니다.
- [ ] **에러 상태 추가**: (높은 항목과 동일) 비동기 작업의 실패 상태를 UI에 명확히 노출합니다.
- [ ] **Provider/파일 정리**: (높은 항목과 동일) 중복 파일을 제거하고 폴더 구조를 명확히 합니다.
- [ ] **구독·리소스 검사**: (중간 항목과 동일) 모든 Notifier/Controller의 리소스 정리 로직을 확인합니다.
- [ ] **사용자 피드백 개선**: 네트워크 지연/실패 시 스켈레톤 UI, 토스트 메시지, 오류 안내 카드 등을 추가하여 사용자 경험을 향상시킵니다.
- [ ] **테스트 추가**: 주요 서비스 로직(스트림 순서), Notifier(상태 전환, 에러 처리)에 대한 단위 테스트를 작성합니다.
- [ ] **로깅 시스템 도입**: `print` 구문을 `logger`와 같은 전문 로깅 패키지로 대체하여, 환경별 로그 레벨 조절 및 구조화된 로깅을 구현합니다.

### 추가 짧은 진단 팁 (빠르게 점검할 항목)

- [ ] **실행 확인**: 인증 흐름(로그인 → AuthGate 리다이렉션)이 의도대로 동작하는지 실제 앱을 실행하여 검증합니다.
- [ ] **메모리/CPU 프로파일링**: Flutter DevTools를 사용하여 페이지 전환 후 `StreamSubscription` 등 리소스가 누수되는지 확인합니다.
- [ ] **빌드 스크립트 확인**: CI 환경에서 코드 생성(`*.g.dart`) 관련 명령이 올바르게 실행되는지 확인합니다.
